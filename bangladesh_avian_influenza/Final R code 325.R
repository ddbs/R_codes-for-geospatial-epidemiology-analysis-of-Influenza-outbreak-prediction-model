detach()rm(list=ls())     # clear everything out of memoryrm(list=ls(all=TRUE))setwd("C:\\2011\\banglaUCMG\\dec_2011_new_analysis")  # set to wherever your data directory is located getwd()           # check that you are in the correct directorylibrary(gtools)library(gdata)library(stats)library(gplots)library(sp)library(splancs)library(lpSolve)library(MASS)library(Epi)library(Hmisc)#library(epicentre) didn't find this, may new epiR package#install.packages('epiR')library(epiR)library(foreign)  # library to read foreign datasetslibrary(geoR)library(gstat)####### Input txt data ######D <- read.table("new_BanglaUCMG1.txt", header=TRUE, sep="\t", na.strings="NA",dec=".")  # read text data fileattach(D)names(D)str(D)?str##### Create new variables#####D$X_COORD  =D$POINT_XD$Y_COORD	=D$POINT_YD$BRLA = D$BIRDS_LYR+D$BIRDS_BROD$BY = D$T_CHICKEN - D$BRLAD$D_BRLA = D$BRLA/ADMSQKMD$T_CHICKEN_log = log10(D$T_CHICKEN+1)D$T_DUCKS_log = log10(D$T_DUCKS+1)D$BRLA_log = log10(D$BRLA+1)D$POP2001_log=log10(D$POP2001+1)D$POP2001_2=(D$POP2001)^2D$D_POP2001_2=(D$D_POP2001)^2D$POP2001_log2=log10(D$POP2001+1)^2D$D_POP2001_log2=log10(D$D_POP2001+1)^2str(D)###### Describe the spatial correlation ########library(gstat)D$X_KM2 = D$X_KM^2D$Y_KM2 = D$Y_KM^2LagInterval = 10qv <- variogram(Boutbreaks ~ 1, width = LagInterval, locations = ~ X_KM + Y_KM, data = D, cutoff = 150)qv.fit = fit.variogram(qv, model = vgm(0.14, "Sph", 100, 0.06), fit.method = 2)plot(qv$dist, qv$gamma, ylim = c(0,0.25),xlab = "Lag (km)", ylab="Semivariance") # plot the resultmyModel = variogramLine(qv.fit,maxdist = 150)lines(myModel$dist,myModel$gamma)myNug = qv.fit[1,2]mySill = qv.fit[2,2]myRange = qv.fit[2,3]text(5,0.04, paste("Nugget :", format(myNug, digits = 3)), pos = 4)text(5,0.025, paste("Sill :", format(mySill, digits = 3)), pos = 4)text(5,0.010, paste("Range :", format(myRange, digits = 3), "km"), pos = 4)text(80,0.025, paste("Lag interval :", format(LagInterval, digits = 1), "m"), pos = 4)text(80,0.010, paste("Min. pairs / lag :", min(qv$np)), pos = 4)########### Function to estimate the autoregressive term ###########myLib.AutoRegressiveQuant = function (myDepVec, myXVec, myYVec, myMaxDist) {#myDepVec = myD$OUTBR#myXVec = myD$X_COORD#myYVec = myD$Y_COORD#myMaxDist = 0.4myARVec = myDepVec * 0nRec =length(myARVec)for (i in 1:nRec) {  myDistVec = (((myXVec[i] - myXVec)^2)+((myYVec[i] - myYVec)^2))^0.5  myDistVecS0 = subset(myDistVec, myDistVec != 0)  myART = sum(1/myDistVecS0)  mySGrid = cbind(myDistVec, myDepVec)  mySSGrid = subset(mySGrid, myDistVec !=0 & myDistVec < myMaxDist)  if (nrow(mySSGrid) > 0) {  myWeigths = 1/(mySSGrid[,1])  mySum = sum(myWeigths * mySSGrid[,2])  myARVec[i] = mySum/myART  }   if (nrow(mySSGrid) == 0) myARVec[i] = 0}return(myARVec)}####### Build the autoregressive term ########D$ArT = myLib.AutoRegressiveQuant(D$Boutbreaks, D$X_KM, D$Y_KM, 101)summary(D$ArT)str(D)summary(D)data.frame(summary(D))######## Full model #######?glmmodel.logit=glm(Boutbreaks~ +BRLA+ T_CHICKEN + BY + T_DUCKS + FIRMS_LYR + BIRDS_LYR +FIRMS_BRO + T_CATTLE + T_BUFFALO + T_GOAT + T_SHEEP + Towns	+ Roads + R_lenght + D_CHICKEN + D_DUCKS	+ D_FARM_LYR + D_LYR +D_FARM_BRO + D_BRO + D_CATTLE + D_BUFFALO + D_GOAT + D_SHEEP + T_CHICKEN_log + T_DUCKS_log + D_BRLA + BRLA_log + No_househo +No_Village + No_Mauza + No_union + D_No_housh + D_No_Mauza + D_No_union +D_Towns + D_Roads + D_R_lenght + POP2001_log2+ DUDN + CHDN + CROPMEAN + RICECROPME + CROPSUM +	RICECROPSU + D_CROPSUM + D_RICECROP + NumberOfFa +ArT, data = D,family=binomial)summary(model.logit)######FINAL_New########model.logit_new=glm(Boutbreaks~  POP2001_log2 + BRLA_log + Roads + NumberOfFa + ArT, data = D,family=binomial)summary(model.logit_new)##############FINAL########model.logit=glm(Boutbreaks~  POP2001_log2 + BRLA_log + Roads + NumberOfFa + ArT, data = D,family=binomial)summary(model.logit)########D$predicts <- predict.glm(model.logit, type="response")str(D)######ROC curve This works well!!!!########ROC( test = D$predicts,     stat = D$Boutbreaks,     form = NULL,     plot = c("sp", "ROC"),                PV = TRUE,                    MX = TRUE,                    MI = TRUE,                   AUC = TRUE,                  grid = seq(0,100,10), col.grid = gray( 0.9 ),     cuts = NULL,      lwd = 2)D$predictsROC( test = D$predicts,     stat = D$Boutbreaks,     form = NULL,     plot = c("sp", "ROC"),                PV = FALSE,                    MX = FALSE,                    MI = FALSE,                   AUC = TRUE,                  grid = seq(0,100,10), col.grid = gray( 0.9 ),     cuts = NULL,      lwd = 2)########################library(utils)write.table (D, file="D.txt", append=FALSE, quote=F, sep="\t", col.names=TRUE, row.names=FALSE)